---
layout: post
title: Location Pickers With Angularjs
demo: http://winkervsbecks.github.io/the-core
source: https://github.com/winkerVSbecks/the-core
---

<p data-height="600" data-theme-id="7569" data-slug-hash="4d0c2a06e9671ec046baf30a16d811a8" data-default-tab="result" data-user="winkerVSbecks" class='codepen'>See the Pen <a href='http://codepen.io/winkerVSbecks/pen/4d0c2a06e9671ec046baf30a16d811a8/'>4d0c2a06e9671ec046baf30a16d811a8</a> by Varun Vachhar (<a href='http://codepen.io/winkerVSbecks'>@winkerVSbecks</a>) on <a href='http://codepen.io'>CodePen</a>.</p>
<script async src="//codepen.io/assets/embed/ei.js"></script>

{% include demo-source.html %}

Building mobile apps often requires capturing the user's location. While, the Cordova geo-location plugin makes it quite trivial to track the latitude and longitude values, it fails to provide any sort of context. Gathering a human-readable address or a description of the place provides a much richer data set.

There are two ways we can capture this rich data:

## 1. Geo-Location to Nearby Locations
We fetch nearby locations based on the geo-location data and allow the user to pick the most appropriate option. For this method we can split the tasks into two services:

### Location
This service checks to see if geo-location is available and grabs the current location. It also allows us to register *on-ready-tasks* with it. Therefore, all the other directives/services which depend on the geo-location data only bootstrap once the data is available.

The geo-location data is captured using using the `navigator.geolocation.getCurrentPosition` method. This works for both desktop browsers and Cordova/PhoneGap.

### Reverse Geocoder
Reverse geocoding is the process of converting geographic coordinates (like latitude 37.423021 and longitude -122.083739) into a human-readable address (such as 1600 Amphitheatre Parkway, Mountain View, CA).

It sets up the [Google Geocoder service](https://developers.google.com/maps/documentation/geocoding/) and uses the geo-location data to fetch, reverse geocoded, nearby locations. The service provides various options with reducing resolution, for example:

- House #, Street, City, Province, Postal Code, Country
- Street, City, Province, Postal Code, Country
- Neighbourhood, City, Province, Country
- City, Province, Postal Code, Country

### Location-Picker
The `Location-Picker` directive packages this into a simple directive. It utilizes the `reverse-geocoder` service to fetch a set of options for the user. The user selection is then bound to the object passed in through the `ng-model` attribute.

{% highlight html %}
<!-- Requires access to the user's geo-location data -->
<location-lookup
    ng-model="lookedUpLocation"
    limit-to="4"></location-lookup>
{% endhighlight %}


## 2. Manually Query the Location Database
The second method is to allow the user to query the location database manually. In this case we use a set of nested directives and the [Google Auto-complete service](https://developers.google.com/maps/documentation/javascript/examples/places-autocomplete).

### Location-Predictions
It's a directive that generates a search box and sets up the Google Auto-complete service. The auto-complete service fetches predictions based on the user submitted query string.

### Location-Lookup
The results from `location-predictions` directive are passed into this directive. Which in turn displays them as a list for the user to pick from. Once the user picks a location it uses the [Google Places service](https://developers.google.com/places/documentation/) to fetch the geo-location data for it.

{% highlight html %}
<!-- Requires user to enter a query -->
<location-picker
    ng-model="pickedLocation"
    limit-to="5"></location-picker>
{% endhighlight %}

## Usage
Both directives are fairly straight forward to use. They essentially behave as a `<select>` element. The selection is captured using `ng-model`. Optionally you can limit the number of choices by using the `limit-to` attribute.

The selection returns the following data:

{% highlight js %}
{
    name: 'Mountain View',
    description: 'Mountain View, CA, United States',
    latitude: 37.3860517,
    longitude: -122.0838511
}
{% endhighlight %}